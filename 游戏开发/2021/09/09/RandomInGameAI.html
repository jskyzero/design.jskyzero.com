<!DOCTYPE html>
<html lang="en">
<!-- <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'self'; style-src 'self' https://fonts.googleapis.com; img-src 'self'; font-src 'self' https://fonts.gstatic.com; connect-src 'self'; media-src 'self'; object-src 'self'; child-src 'self'; form-action 'none'; base-uri 'self'" /> -->
<meta http-equiv="X-XSS-Protection"  content="1;mode=block" always>
<meta http-equiv="Referrer-Policy" content="no-referrer, strict-origin-when-cross-origin"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>用于AI的高级随机技术 | 设计者笔记</title><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="用于AI的高级随机技术" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="本文会深入讲解游戏AI的若干随机算法，并附带通俗易懂的例子，严谨的模拟试验，和技法实用运用指南。" />
<meta property="og:description" content="本文会深入讲解游戏AI的若干随机算法，并附带通俗易懂的例子，严谨的模拟试验，和技法实用运用指南。" />
<link rel="canonical" href="https://design.jskyzero.com/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/2021/09/09/RandomInGameAI.html" />
<meta property="og:url" content="https://design.jskyzero.com/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/2021/09/09/RandomInGameAI.html" />
<meta property="og:site_name" content="设计者笔记" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-09T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="用于AI的高级随机技术" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-09T00:00:00+00:00","datePublished":"2021-09-09T00:00:00+00:00","description":"本文会深入讲解游戏AI的若干随机算法，并附带通俗易懂的例子，严谨的模拟试验，和技法实用运用指南。","headline":"用于AI的高级随机技术","mainEntityOfPage":{"@type":"WebPage","@id":"https://design.jskyzero.com/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/2021/09/09/RandomInGameAI.html"},"url":"https://design.jskyzero.com/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/2021/09/09/RandomInGameAI.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" type="text/css" href="/assets/main.css"></head>
<body>
    <div class="container"><header>
  <div class="menu">
    <ul><li><a href="/">/</a></li><li><a href="/program/">/Program</a></li><li><a href="/github/">/Github</a></li><li><a href="/project/">/Project</a></li></ul>
  </div>
</header>
<main>
      <div id="index">
  <ul class="md-toc">
  <li class="md-toc-h1"><a href="#用于ai的高级随机技术">用于AI的高级随机技术</a>
    <ul>
      <li class="md-toc-h2"><a href="#随机的意义">随机的意义</a></li>
      <li class="md-toc-h2"><a href="#随机的类型">随机的类型</a>
        <ul>
          <li class="md-toc-h3"><a href="#均等分布">均等分布</a></li>
          <li class="md-toc-h3"><a href="#高斯分布">高斯分布</a></li>
          <li class="md-toc-h3"><a href="#柏林噪声">柏林噪声</a></li>
        </ul>
      </li>
      <li class="md-toc-h2"><a href="#虚伪的随机">虚伪的随机</a>
        <ul>
          <li class="md-toc-h3"><a href="#随机值筛选">随机值筛选</a></li>
        </ul>
      </li>
      <li class="md-toc-h2"><a href="#总结与参考">总结与参考</a></li>
    </ul>
  </li>
</ul>
  

<p id="pro">
  
  <!-- <div class="categories"> -->
    
    
    <img src="https://img.shields.io/badge/游戏开发-blue.svg?style=flat" alt="">
    <!--  -->
    
  <!-- </div> -->
  
  <img src="https://img.shields.io/badge/作者-jskyzero-brightgreen.svg?style=flat" alt="">
  <img src="https://img.shields.io/badge/日期-2021/09/09-brightgreen.svg?style=flat" alt="">
</p>



</div>

<p>本文会深入讲解游戏AI的若干随机算法，并附带通俗易懂的例子，严谨的模拟试验，和技法实用运用指南。</p>

<!--more-->

<h1 id="用于ai的高级随机技术">用于AI的高级随机技术</h1>

<p><img src="/assets/img/skill/RandomInGameAI/1 (3).JPG" alt="" /></p>

<ul>
  <li>本文最初为神秘组织编写。希望大家都能深入理解艺术与科学</li>
  <li>本文主要讨论游戏AI，或者<a href="https://www.youtube.com/channel/UC4YaOt1yT-ZeyB0OmxHgolA">人工（キズナ）智障（アイ）</a></li>
  <li>本文最初以为会涉及计算机科学，实际没有，放在这里吓唬人</li>
  <li>本文包含概率论，但是不用怕，<strong><u>作者概率论学得没你好</u></strong></li>
  <li>本文参考了<a href="http://www.gameaipro.com/">Game AI Pro</a>的文章，知识是相通的，翻新了文中的试验，添加了与时俱进的例子</li>
  <li>作者会从读者的角度揣测可能的疑问，并先手提出解答，如果遗漏可以联系作者</li>
  <li>本文使用python语言，但是不要怕，反正正常人都看不懂，天书没有区别</li>
  <li>本文例子大量使用神秘组织所推崇的游戏《SEKIRO》，很遗憾例子没能全部使用此游戏</li>
</ul>

<h2 id="随机的意义">随机的意义</h2>

<blockquote>
  <p>重复着无数相同的动作，我是为了表演而生，</p>

  <p>而表演……是为了取悦你。——《人偶自白》</p>
</blockquote>

<p><img src="/assets/img/skill/RandomInGameAI/1 (6).JPG" alt="" /></p>

<p>总所周知，游戏AI为了良好游戏体验服务。——后边部分的定义基本是句废话，过分感性。不同游戏类型目标体验之间的差距，比人和人的差距还要大。</p>

<p>为此，这里从玩家角度、引入消费时经常使用的“质量”的概念来分析一个游戏的体验</p>

<ul>
  <li>从切片、微观上来说，要讲究质：
    <ul>
      <li>体验要达到类型预期及格线，有基本的保真度</li>
      <li>体验要结构完整，有始有终</li>
      <li>部分好游戏的部分体验会“大大超出预期”</li>
    </ul>
  </li>
  <li>从整体、宏观上来说，要讲究量：
    <ul>
      <li>高质量的内容以合适的节奏投放给玩家</li>
      <li>投放本身也可以构成一种“涌现”的叙事</li>
    </ul>
  </li>
</ul>

<p>于是问题被转移到了高质量内容生产上，除了切实的生产新内容，合理的使用旧内容，比如<strong><u>利用随机</u></strong>，也能带来良好的体验。</p>

<p>以动作游戏为例，考虑移动等行为本身的差异性、动作之间不同的衔接、动作释放的概率组成不同的考验等。下面我们给出更加具体的例子：</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (7).JPG" alt="" /></p>

<p>以怪物设计为例：</p>

<ul>
  <li>从怪物整体上来看
    <ul>
      <li>我们可以切实的生产新的故事设定、区域环境、敌人兵种、敌人本身，构建一种有血有肉的敌人</li>
      <li>比如：只狼故事初期遇到的苇名兵，回到3年前会遇到山贼、寺庙附近遇到僧兵，游戏后期遇到的使用火药的赤备队等。</li>
      <li>我们也可以运用随机的手法，扩充单类敌人的体验，让不同感受的同种敌人交替出现</li>
      <li>比如外观上的差异、体型的差异、武器的差异等</li>
    </ul>
  </li>
  <li>从怪物自身上来看
    <ul>
      <li>我们需要生产怪物符合怪物性格的整套动作资产</li>
      <li>比如休闲状态、攻击状态的移动、转换，特色的攻击动作、“打铁”玩法的格挡动作，其他演出动作等</li>
      <li>我们可以用随机的手法，使得单个动作能有更为丰富的体验</li>
      <li>比如移动的方向、时间、结束距离，是否衔接移动等等；动作直接的组合，以何等行为逻辑、哪些攻击手法组合呈现给玩家，也大有可为。</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/img/skill/RandomInGameAI/1 (8).JPG" alt="" /></p>

<p>提到AI中的随机，反应性和随机性是绕不开的话题。</p>

<p>这两种特性，或者说思考方式，是AI最常见的逻辑组织方式，配合差异性的动作，能够构建出表现丰富的AI体验，下面我们给出一个具体的例子：</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (9).JPG" alt="" /></p>

<blockquote>
  <p>只狼因为资源格式和数据组织解构大体沿用黑魂，可以用工具进行拆包、反编译得到其具体逻辑配置。
展示的数据略去繁琐的处理过程，仅对设计进行讨论。</p>
</blockquote>

<p>以只狼中的某只基础小怪为例，它有8种基础行为（动作资源 + 逻辑脚本配置，最终构成基础行为）。</p>

<p>这些行为<strong><u>以距离为条件划分</u></strong>：</p>

<ul>
  <li>距离较远：靠近</li>
  <li>距离偏远：靠近 + 靠近攻击</li>
  <li>距离适中：攻击</li>
  <li>距离过近：攻击 + 远离攻击 + 远离</li>
</ul>

<p>类似的，后面我们还将看到BOSS的AI。</p>

<h2 id="随机的类型">随机的类型</h2>

<blockquote>
  <p>不重复别人是重要的。</p>

  <p>不重复自己是尤其重要的。——（中国作家）陈祖芬</p>
</blockquote>

<p>在了解了随机的目的与基本用法后，本章我们开始讨论具体的随机概率模型。</p>

<h3 id="均等分布">均等分布</h3>

<p><img src="/assets/img/skill/RandomInGameAI/1 (11).JPG" alt="" /></p>

<p>均等概率自然是最基础的随机模型。</p>

<p>大部分时候，我们使用的都是离散的均等随机，即便是如图二，也只是把1标准单位拆为了1000份。</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (12).JPG" alt="" /></p>

<p>以弦一郎的AI为例，在特定距离内，拥有6种行为，按照预期概率进行分布。</p>

<p>值得一说的是：</p>

<ul>
  <li>不同环境的新判别标准
    <ul>
      <li>引入了除了距离外的新因素：架势值</li>
      <li>就像一般会用的血量、时间等</li>
    </ul>
  </li>
  <li>随时间的差异概率模型（解决长时间的内容疲倦问题）
    <ul>
      <li>弦一郎有三个阶段，三个阶段的招式是有差异的</li>
      <li>基本上难度是递进的，以至于在第三阶段见到第一阶段的技能会觉得处理得十分得心应手</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/img/skill/RandomInGameAI/1 (13).JPG" alt="" /></p>

<p>最后我们对固定概率随机进行一个简单的小结。</p>

<h3 id="高斯分布">高斯分布</h3>

<p><img src="/assets/img/skill/RandomInGameAI/1 (14).JPG" alt="" /></p>

<p>正态分布本质上是一种对自然的拟合：</p>

<ul>
  <li>图1：
    <ul>
      <li>我们进行1000次随机1-6的掷骰子，得到的统计图</li>
    </ul>
  </li>
  <li>图2：
    <ul>
      <li>我们每次进行3个1-6的掷骰子，将结果求和，重复1000*6*3次，得到的统计图</li>
    </ul>
  </li>
  <li>图3：
    <ul>
      <li>我们将3个扩大到10个，次数扩大到1000*6*10次，得到的统计图</li>
    </ul>
  </li>
</ul>

<p>你会发现，当大量因素都对结果有或大或小影响，最终结果的将会呈现出正态分布。</p>

<p>就像自然界中植物最终的高度，可能受到种子、土壤、水分、空气、光照等等因素的影响。最后综合到一起，就会变成正态分布。</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (15).JPG" alt="" /></p>

<p>很遗憾，这里本来是想找一些<strong><u>使用正态分布产生不同体型的怪物</u></strong>的例子的，但是作者失败了。</p>

<p>在只狼的樱龙BOSS战的前期阶段，需要杀大量的“小龙人”，很可惜，小龙人长得一样高。甚至有种诡异的美感</p>

<p>在黑暗之魂3的幽邃主教群BOSS战中，需要杀大量的主教，很可惜，主教做了几种体型，前后参差，但是相同体型一样高。</p>

<p>不得不再说一次，随机只是一种做法，采用不采用都可以，满足目标体验需求即可。</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (16).JPG" alt="" /></p>

<p>另外一边，怪物猎人：世界，中的大小金可以说是一个极佳的例子。</p>

<p>本身同一只怪物狩猎时间较长，又需要反复狩猎，于是引入了差异体型和对差异体型追求的大小金玩法。</p>

<p>虽然无从论证到底是不是正态分布（刷大小金的过程中只要不是目标体型就重置了OTZ），但是呈正态分布大致也是没问题的。</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (17).JPG" alt="" /></p>

<p>自然而然地，想到了环境生物的差异体型。</p>

<p>怪物猎人：世界中会有普通或稀有的环境生物，也有各自的体型，也有一部分玩家会去追求这些。比如图上的摇曳鳗女王，只在夜晚的陆珊瑚地图出现（虽然大概是王溟波任务100%刷出），想要刷出来还是要费些功夫的。</p>

<p>那么只狼中也是有杀锦鲤、收集鳞片的，理论上给鱼做一些随机体型，也是不错的，但是我们发现只狼中把体型这件事做得更为夸张，甚至还有剧情和选择，最后结局十分具有冲击性。</p>

<p>这其实还是定制内容或者填充内容的选择问题，两者如上文所言，各有优劣。</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (18).JPG" alt="" /></p>

<p>那么对正态分布做一个总结，如上图。</p>

<p>需要一说的是，LOD级别，指的是不会被玩家注意到，去留意其行踪的填充级别（否则会穿帮！）</p>

<p>右边我们以子弹命中为例子来更加具体的对比一下随机分布与正态分布：</p>

<ul>
  <li>随机分布永远都在指定范围内，而正态分布可能超出屏幕（三个标准差）外</li>
  <li>随机分布均匀分布，而正态分布从中间到四周由密集到稀疏</li>
</ul>

<p><img src="/assets/img/skill/RandomInGameAI/1 (19).JPG" alt="" /></p>

<p>这里也把生产过程做一个呈现，留意最终的随机生成方法：</p>

<ul>
  <li>实现了个画三个圆和指定数据点的绘制函数</li>
  <li>实现了个极坐标系转平面直角坐标系的绘制函数</li>
  <li>实现了以指定方法生成指定个数，并绘制出来的生成函数</li>
</ul>

<p>接下来我们指定生成方法和个数：</p>

<ul>
  <li>随机分布：
    <ul>
      <li>随机角度0-360度</li>
      <li>随机距离0-最大值</li>
    </ul>
  </li>
  <li>正态分布：
    <ul>
      <li>随机角度0-360度（没错！角度仍然是均等随机！）</li>
      <li>正态分布距离，最大值为三个标准差</li>
    </ul>
  </li>
</ul>

<p>就可以得到对应的分布图。</p>

<h3 id="柏林噪声">柏林噪声</h3>

<p><img src="/assets/img/skill/RandomInGameAI/1 (20).JPG" alt="" /></p>

<p>到这里开始内容就逐渐“玄幻”起来，理想噪声的标准听起来，大概像是是：变化与方向无关；没有剧变；变化与距离无关（如果不对也很正常，门外汉的理解）。</p>

<p>下方的折线图可以看出，柏林噪声或者柏林随机最重要的特性：连续！前面的随机都是离散的，会突变的。</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (21).JPG" alt="" /></p>

<p>这里给出两个可能的使用场景，就如之前的鱼一样，这里只是可以这么做，实际需不需要做，需要根据需求判断。</p>

<p>只狼中有需要在白蛇神眼皮底下开溜的流程，恶魔之魂中的龙神boss战也是类似的玩法，这里两者都是默认固定周期摆动，实际上头部的旋转就可以使用柏林噪声的连续随机，当流程时间被拉得更长，做固定的几种动作已经没法满足，或者需要做大量随机待机的表现，就可以使用随机来“填充内容”。</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (22).JPG" alt="" /></p>

<p>总结一下柏林噪声的随机，最大的特征就是连续而不是离散，可以用在各种连续情况，右边介绍了一些基础的控制方式，这里不进行过多展开，有需要时再查阅即可。</p>

<p>现在柏林噪声更多的用在随机地图生成等场合，同样也需求连贯的随机。</p>

<h2 id="虚伪的随机">虚伪的随机</h2>

<blockquote>
  <p>正确的结果，是从大量错误中得出来的；</p>

  <p>没有大量错误作台阶，也就登不上最后正确结果的高座。——钱学森</p>
</blockquote>

<h3 id="随机值筛选">随机值筛选</h3>

<p><img src="/assets/img/skill/RandomInGameAI/1 (24).JPG" alt="" /></p>

<p>想要说明白计算机的伪随机、或者自然环境下的真随机，有时并不是我们想要的随机这一点，有些复杂，会比较类似复杂的逻辑下特定情况出现的“人工愚蠢”的现象，这里作者用一个亲身经历的例子来说明这一点。</p>

<p>某天晚上，作者在看所在项目的制作人体验作者配置的AI，好巧不巧，中间的AI机缘巧合连续闪避了多次，于是制作人提出致命问题：为什么它闪避了这么多次？这合理吗？</p>

<p>当然，这是作者配置的问题，有很多方法可以解决，但是第一反应下，假设这种情况的只有跑开和闪避两种行为，概率五五开，大量试验下是一定会出现这种连续触发闪避的。</p>

<p>作者自然不能跟制作人讲，这是一个统计学问题，你也不能跟你的玩家讲，“你这是个概率问题，我的AI逻辑十分精妙，这只是个巧合！”。</p>

<p>所以我们引入了“筛选”的概念，逻辑十分好懂，发现不合适的，就打回去，重新随。</p>

<p><img src="/assets/img/skill/RandomInGameAI/1 (25).JPG" alt="" /></p>

<p>比较复杂的地方在于，针对各种随机数据类型或者随机模型，如何判断是否不合适，上图给出了一些判断条件的例子。</p>

<p>大概的通用规律是：</p>

<ul>
  <li>不可以重复出现、间隔出现</li>
  <li>不可以同趋势出现、连续将近</li>
  <li>统计学意义上大体随机</li>
</ul>

<p><img src="/assets/img/skill/RandomInGameAI/1 (26).JPG" alt="" /></p>

<p>当然，规则也不是越复杂越好的，过于复杂可能导致随机本身失去意义。</p>

<p>可以使用一些工具检验你的检查条件是否会破坏随机完整性，已经有比较成熟的方案了，这里不展开叙述。</p>

<h2 id="总结与参考">总结与参考</h2>

<p><img src="/assets/img/skill/RandomInGameAI/1 (1).JPG" alt="" /></p>

<p>最后对本文的内容做一个总结：如上图。</p>

<p>还是想再次重申：随机是一种方法，它为了我们的目标体验而服务。</p>

<p>若干参考，如下：</p>

<ul>
  <li><a href="https://github.com/jskyzero/GameAI.Random/blob/master/GameAI.Random.ipynb">文中模拟试验的源码</a>，<a href="https://jskyzero.github.io/GameAI.Random/">网页版</a></li>
  <li><a href="http://www.gameaipro.com/GameAIPro/GameAIPro_Chapter03_Advanced_Randomness_Techniques_for_Game_AI.pdf">Advanced Randomness Techniques for Game AI: Gaussian Randomness, Filtered Randomness, and Perlin Noise, Steve Rabin, Fernando Silva, Jay Goldblatt</a></li>
</ul>



<pre class="post-content controls__inner git-log"><output>~: git log
10 Feb 2022 - jskyzero - ✨ change categories
24 Oct 2021 - jskyzero - 🐛 update tag
21 Sep 2021 - jskyzero - ✨ add pro tag
21 Sep 2021 - jskyzero - 🔥 remove {{site.img_url}}
12 Sep 2021 - jskyzero - 🐛 修改错别字
10 Sep 2021 - jskyzero - finish 用于AI的高级随机技术
09 Sep 2021 - jskyzero - 🐛  change jpg to JPG
09 Sep 2021 - jskyzero - 🎨 add 用于AI的高级随机技术 & update histroy

<img alt="Creative Commons License" src="/assets/img/cc.png" />

This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 License</a>.
</output></pre>


<script src="/assets/js/main.js"></script>
<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = 'https://design.jskyzero.com/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/2021/09/09/RandomInGameAI.html';
this.page.identifier = 'https://design.jskyzero.com/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/2021/09/09/RandomInGameAI.html';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://designer-notes.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the comments.</noscript>


    </main><footer>
  <p>Enjoy :)</p>
  <span>&copy; 2022 设计者笔记. All rights reserved.</span>
</footer>
</div>
  </body>
</html>
