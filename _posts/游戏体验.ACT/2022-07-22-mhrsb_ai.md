---
layout: post
title: "怪物猎人中的AI出招设计"
categories: [动作游戏分析]
---

以拆包和体验来推导一下怪物猎人的AI出招逻辑，感受可能是市面上PVE动作游戏TTK最长、规则最丰富的单局战斗体验！

<!--more-->

# 怪物猎人中的AI出招设计


## 前言

如果要参考学习动作游戏PVE的BOSS设计的话，我想怪猎系列的怪物可能是绕不开的一个课题，它有着相对简单的关卡设计，衬托出纯度更高的战斗、丰富的机制与动作，带来反复游玩的乐趣。在MHW这一作，它经受住了大环境下ACT品类没落的考验，一跃成为了ACT游戏中最耀眼的明星之一。

本文将**从拆包、体验反推两个视角**来窥视怪物猎人的AI，聚焦在怪物AI出招的设计、和这些设计是如何影响玩家的体验的。文章末尾会对比这两种方式，聊聊它俩各自的特点，以及在游戏反拆时适用的场合。


## 拆包

基本上，只要**有MOD的游戏，就代表玩家群体已经掌握了游戏文件组织的大体结构**——毕竟MOD，就是把玩家的内容，替换、修改厂商的内容。得先弄明白文件放到哪里，才能放过去让文件生效。对于大多数对MOD没有积极持支持态度的游戏开发商，这往往意味着已经有一个工具可以针对玩家的二进制分发文件进行解密解压缩处理。

感谢卡普空从MHW以来对PC的友好态度，MHW/MHWIB、MHR/MHRSB，都有着相当多的外观、易用性MOD，繁荣的MOD当然也就意味着，玩家对游戏文件有着相当的了解，从Github、NEXUSMODS上顺藤摸瓜成功找到了MHRSB的[MOD教程](https://github.com/mhvuze/MonsterHunterRiseModding)，里面自然有[拆包过程的说明](https://github.com/mhvuze/MonsterHunterRiseModding/wiki/Extracting-Game-Files-(PC))，事不宜迟，拆了看看AI配置吧！


### 繁多的状态机

从`re_chunk_000\natives\STM\enemy\em001\`就可以定位到具体怪物，查一下[怪物ID表](https://github.com/mhvuze/MonsterHunterRiseModding/wiki/Monster-IDs)，001是Rathian，也就是我们的老朋友——雌火龙。

对于一只具体的怪物，解包后的文件目录如下，我们关注的也就是`ai_fsm_user_data`下的文件，fsm，看起来底层驱动的技术是有限状态机。

```bash
.
├── 00
│   ├── ai_fsm_user_data
│   ├── collision
│   ├── mod
│   ├── mot
│   ├── prefab
│   ├── shell
│   ├── user_data
│   └── user_variables
├── 02
├── 07
└── common
    ├── act_tbl_user_data
    ├── mod
    ├── mot
    ├── motion_fsm
    └── user_data
```

`ai_fsm_user_data`下的文件就多起来了，以雌火龙00的`em001\00\ai_fsm_user_data`的为例，有多达125个文件：


```bash
.
├── flow
│   └── em001_00_predator_relevant_action.user.2
├── hub
│   ├── damage
│   │   ├── fly
│   │   │   ├── em001_00_fly_element_weak_damage.user.2
│   │   │   ├── em001_00_fly_em2em_damage.user.2
│   │   │   └── ...
│   │   └── stand
│   │       ├── em001_00_stand_element_weak_damage.user.2
│   │       ├── em001_00_stand_em2em_damage.user.2
│   │       └── ...
│   ├── die
│   │   ├── fly
│   │   │   ├── em001_00_fly_capture.user.2
│   │   │   └── em001_00_fly_normal_die.user.2
│   │   └── stand
│   │       ├── em001_00_stand_capture.user.2
│   │       └── em001_00_stand_normal_die.user.2
│   ├── em001_00_arrange.user.2
│   ├── em001_00_arrange_hyakuryu.user.2
│   └── ...
└── think
    ├── em001_00_damage.user.2
    ├── em001_00_die.user.2
    └── ...

9 directories, 125 files
```

> 果然“软件开发没有银弹”，怪猎的怪物单局行为丰富，连AI配置文件都有120多个……太强了。

很可惜，目前用于拆包后的`.user.2`类型文件的[MHR Editor](https://github.com/Synthlight/MHR-Editor)，尚且不支持打开编辑这些AI文件，姑且用`HexEditor`试着看了下一些文件的内容，看到了一些类似USR开头、RSZ用作分割之类的信息，但是也没有啥有价值的内容。

![](/assets/img/gameplay/mhrsb.AI/HexEditor.jpg)

看不到具体的文件，就只能看看能不能从文件名中间得到些信息了。


### 盲人摸象

试着对文件名进行了一些标注（拿不准胡猜的东西标了黄色）：

![](/assets/img/gameplay/mhrsb.AI/em001-00.svg)

+ 硬直

在标注的过程中发现了一些[硬直机制](https://bbs.nga.cn/read.php?tid=21732718&rand=636)相关的文件，这些文件相较于AI，更像是动作跳转的逻辑。

比如死亡、捕获，又比如经典麻痹、眩晕、睡眠。

合理推测，可能有一部分硬直的动作逻辑是靠这些AI来控制的？

![](/assets/img/gameplay/mhrsb.AI/1.jpg)


+ 避障/场地移动

可以把动作游戏的AI划分为攻击/移动，而移动中免不了的一部分就是类似避障、返回场地中央之类的逻辑，这么一看大家还是都会面临这些问题的。


![](/assets/img/gameplay/mhrsb.AI/2.jpg)


+ 横向比较

除了001我们也看一下093爵银龙，对比一下各自的`ai_fsm_user_data`的文件列表

|比较对象|比较结论|
|--|--|
|em001-00/em001-02/em001-07|02和07都是00的子集，02和07略有不同|
|em093-00/em093-01|01是00的子集|
|em001-00/em093-00|略有不同|

+ 简要总结

MHRSB的AI通过划分不同场景，将复杂的逻辑成功细分到多种场合的单个逻辑，这种做法可以**降低单个文件的复杂度**，同时，单个逻辑文件**可以作为特性组件**动态的给某只怪物添加或者删除（比如觅食逻辑）。

我们最关心的出招逻辑AI，目测是在某个单个细分逻辑中。尝试继续寻找出招逻辑AI，从文件大小里面筛了一下，还是没有结论。


## 体验反推


以下施工中……


## 其他参考

+ [MHRISE.KIRANICO Rathian](https://mhrise.kiranico.com/data/monsters/366824395)
+ [mhrice.info Rathian](https://mhrise.mhrice.info/version/10.0.2/monster/001_00.html)
