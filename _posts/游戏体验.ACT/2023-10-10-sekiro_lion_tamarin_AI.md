---
layout: post
title: 拆包看狮子猿AI设计
categories: [动作游戏分析]
---

之前拆包看了[只狼的狮子猿的一阶段动画](https://design.jskyzero.com/2023/02/17/sekiro_lion_tamarin/)，本文则会对怪物的AI进行一些讨论和分析，并对之前文章的一些错误结论进行勘误。

本文的目标是以狮子猿一阶段**成熟完备的AI**为例子，让读者能对动作游戏中AI的设计有一个初步的理解，并分析一些对实际工作中设计有启发的逻辑细节。本文会分为三个部分：初步的体验反推、拆包后对主AI分析的架构设计、以及细节和感受分析和讨论。


# 拆包看狮子猿AI设计


## 初步的体验反推

首个尝试，和狮子猿录了一段素材，用肉眼将动作与之前的状态机进行匹配，得到了如下的结果：

![](/assets/img/gameplay/sekiro_lion_tamarion_ai/1.png)

> 全程视频可参考：[Bilibili 笨办法](TODO)

其中的标注和动画状态机对应如下表所示：

|标注|类别|动画|
|--|--|--|
|连段1|花里胡哨类|3019;3020|
|连段2|花里胡哨类|3000;3001|
|连段2.变种|花里胡哨类|3000|
|连段3|花里胡哨类|3003;3004|
|连段4|花里胡哨类|3021|
|跳跃攻击|记忆点类|3014|
|红光1|记忆点类|3016|
|空窗期|表演类|四方向闪避位移|
|空窗期|表演类|原地吼，3018|


### 交错比例与招式CD

从这个视频中我们可以得出一些初步的结论:


+ 攻击与空隙交错，那么比例是？

![](/assets/img/gameplay/sekiro_lion_tamarion_ai/2.png)

大体上，狮子猿会维持如上图所示【攻击，空窗期】这样的单元重复，以此营造出凶猛进攻和灵动移动结合的交手体验。

其中，攻击的长度观察为1-4个完整招式，而空窗期通常为一次闪避位移。


+ 招式没有复读，那么CD是？
  
![](/assets/img/gameplay/sekiro_lion_tamarion_ai/3.png)

将招式分别拆开，我们会发现同个招式没有连续两次出现的情况。观察两个招式之间的最短间隔时长（从上一个末尾到下一个的开始）：


|标注|最短时间间隔约|动画|
|--|--|--|
|连段1|∞|3019;3020|
|连段2与变种|6|3000;3001|
|连段3|∞|3003;3004|
|连段4|6|3021|
|跳跃攻击|50|3014|
|红光1|9|3016|
|空窗期|5秒|四方向闪避位移|


### 用行为树的简单拟合

总结一些关键结论：

1. 攻击行为与空窗期相间
2. 攻击行为自身有间隔

我们可以使用行为树对这个`出招序列`进行一个简单的拟合：

![](/assets/img/gameplay/sekiro_lion_tamarion_ai/4.png)

这个决策逻辑相当简单，这段战斗也只是一个序列，都充满着局限性，不过还是做一个思考练习，如何让这个逻辑变得更好？

+ 与战斗进程挂钩的空窗间隔

简单来说，通过控制空窗期的CD来控制玩家的战斗压力，结合一个能反映玩家战斗进程的数值——比如血量或者时间，就可以形成差异化的心流体验或者战斗历程。

+ 更加复杂且细致的条件

和上面的思路类似，我们可以为不同的技能设置除了CD以外更加细致的条件，比如关联自身血量，对于只狼来说，基础重要属性还有自身的架势槽；对于一个常规的动作游戏，还可以关联敌我的空间位置关系。

+ 攻击前的调整位置

对于一个动作游戏，招式的适用打击距离，一般是有限的。比如一个前冲拳，能冲的距离可能最多4米，那么对于4米外的目标，可能就需要先靠近目标再释放，不然就会形成空挥的体验（当然，空挥也是一种体验！）。对于4米内过近的目标，可能也需要先远离，避免一些不好的表现。

当然这部分可以通过设置招式前的距离检测来避免。这些检测相应的也会造成限制，这是一个取舍问题。

+ 小结

以传统而经典的行为树配置方法的话，对狮子猿AI的分析大致如上所述。当然，文章的长度已经出卖了作者，下文才是本次分析的重点，但是上文所叙述一些分析方法乃至思路也是相当重要的。

那么话不多说，我们来看看拆包/反编译后的狮子猿AI的LUA脚本。


## 基于LUA的架构设计


## 感受与细节设计


## 参考
